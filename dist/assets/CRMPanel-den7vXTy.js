import{r as l,z as x,s as e,U as E,Q as n,R as F}from"./index-Bp_UmaCL.js";import{I as y,B as $}from"./input-GzHbweEW.js";import{B as i}from"./badge-BsIsCzmH.js";import{S as B}from"./search-hwF9FksX.js";import{L as M}from"./loader-2-B7eL5lYw.js";import{C as O}from"./chevron-down-CrnT9gvK.js";import{S as q}from"./sticky-note-SMAQxov7.js";import"./index-CvZeWDWn.js";const f=["new","qualified","proposal","negotiation","won","lost"],S={new:"bg-neutral-100 text-neutral-700",qualified:"bg-blue-100 text-blue-700",proposal:"bg-purple-100 text-purple-700",negotiation:"bg-amber-100 text-amber-700",won:"bg-emerald-100 text-emerald-700",lost:"bg-red-100 text-red-700"};function Y({config:z}){const[g,C]=l.useState([]),[_,j]=l.useState(!0),[r,N]=l.useState("table"),[d,k]=l.useState(""),[c,A]=l.useState(""),[m,G]=l.useState(""),[p,L]=l.useState(null),[b,P]=l.useState({}),[u,v]=l.useState(""),o=l.useCallback(()=>{j(!0);const t=new URLSearchParams;c&&t.set("stage",c),m&&t.set("tag",m),x.get(`/api/crm/contacts?${t}`).then(a=>{var s;return C(((s=a.data)==null?void 0:s.data)||[])}).catch(console.error).finally(()=>j(!1))},[c,m]),h=l.useCallback(()=>{x.get("/api/crm/pipeline").then(t=>{var a;return P(((a=t.data)==null?void 0:a.pipeline)||{})}).catch(console.error)},[]);l.useEffect(()=>{r==="table"?o():h()},[r,o,h]);const D=async(t,a)=>{try{await x.put(`/api/crm/contacts/${t}`,{deal_stage:a}),r==="table"?o():h()}catch(s){console.error("Update failed:",s)}},T=async t=>{if(u.trim())try{await x.put(`/api/crm/contacts/${t}`,{notes:u}),v(""),o()}catch(a){console.error("Note failed:",a)}},w=t=>t>=70?"bg-emerald-500":t>=30?"bg-amber-500":"bg-neutral-300",U=g.filter(t=>d?(t.username||"").toLowerCase().includes(d.toLowerCase())||(t.sender_id||"").includes(d):!0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-violet-500"}),"CRM",e.jsx(i,{variant:"secondary",children:g.length})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"flex bg-neutral-100 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>N("table"),className:n("px-3 py-1 rounded-md text-xs font-medium",r==="table"?"bg-white shadow-sm":""),children:"Table"}),e.jsx("button",{onClick:()=>N("pipeline"),className:n("px-3 py-1 rounded-md text-xs font-medium",r==="pipeline"?"bg-white shadow-sm":""),children:"Pipeline"})]})})]}),r==="table"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-neutral-400"}),e.jsx(y,{placeholder:"Search contacts...",value:d,onChange:t=>k(t.target.value),className:"pl-9"})]}),e.jsxs("select",{value:c,onChange:t=>A(t.target.value),className:"px-3 py-2 border border-neutral-300 rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"All Stages"}),f.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]})]}),_?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(M,{className:"w-6 h-6 animate-spin text-neutral-400"})}):e.jsx("div",{className:"bg-white rounded-xl border border-neutral-200 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 font-medium text-neutral-600",children:"Contact"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-neutral-600",children:"Score"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-neutral-600",children:"Tags"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-neutral-600",children:"Stage"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-neutral-600",children:"Messages"}),e.jsx("th",{className:"text-right px-4 py-3 font-medium text-neutral-600",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:U.map(t=>{var a;return e.jsxs(F.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-neutral-50 cursor-pointer",onClick:()=>L(p===t.sender_id?null:t.sender_id),children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 flex items-center justify-center text-white text-xs font-medium",children:(t.username||t.sender_id).slice(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-neutral-900",children:["@",t.username||t.sender_id.slice(-8)]}),t.ai_paused&&e.jsx(i,{variant:"outline",className:"text-xs text-orange-600",children:"Paused"})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 h-2 bg-neutral-100 rounded-full overflow-hidden",children:e.jsx("div",{className:n("h-full rounded-full",w(t.lead_score)),style:{width:`${t.lead_score}%`}})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600",children:t.lead_score})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex gap-1 flex-wrap",children:(t.tags||[]).slice(0,3).map(s=>e.jsx(i,{variant:"outline",className:"text-xs",children:s},s))})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("select",{value:t.deal_stage||"new",onChange:s=>{s.stopPropagation(),D(t.sender_id,s.target.value)},onClick:s=>s.stopPropagation(),className:n("px-2 py-1 rounded-md text-xs font-medium border-0",S[t.deal_stage||"new"]),children:f.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})}),e.jsx("td",{className:"px-4 py-3 text-neutral-600",children:((a=t.engagement_signals)==null?void 0:a.message_count)||0}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx(O,{className:n("w-4 h-4 transition-transform",p===t.sender_id&&"rotate-180")})})]}),p===t.sender_id&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-4 bg-neutral-50",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-neutral-700 mb-2 flex items-center gap-1",children:[e.jsx(q,{className:"w-4 h-4"})," Notes"]}),(t.notes||[]).map(s=>e.jsxs("div",{className:"text-xs text-neutral-600 mb-1 bg-white rounded p-2",children:[s.text,e.jsx("span",{className:"text-neutral-400 ml-2",children:new Date(s.created_at).toLocaleDateString()})]},s.id)),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(y,{value:u,onChange:s=>v(s.target.value),placeholder:"Add a note...",className:"text-sm h-8",onClick:s=>s.stopPropagation()}),e.jsx($,{size:"sm",className:"h-8",onClick:s=>{s.stopPropagation(),T(t.sender_id)},children:"Add"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-neutral-700 mb-2",children:"Details"}),e.jsxs("div",{className:"text-xs text-neutral-600 space-y-1",children:[e.jsxs("p",{children:["Sentiment: ",e.jsx(i,{variant:"outline",className:"text-xs",children:t.sentiment||"neutral"})]}),e.jsxs("p",{children:["Language: ",t.language||"en"]}),e.jsxs("p",{children:["First contact: ",t.updated_at?new Date(t.updated_at).toLocaleDateString():"N/A"]}),t.custom_fields&&Object.entries(t.custom_fields).map(([s,R])=>e.jsxs("p",{children:[s,": ",String(R)]},s))]})]})]})})})]},t.sender_id)})})]})})]}):e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4",children:f.map(t=>e.jsxs("div",{className:"min-w-[240px] flex-shrink-0",children:[e.jsxs("div",{className:n("rounded-t-lg px-3 py-2 text-sm font-medium",S[t]),children:[t.charAt(0).toUpperCase()+t.slice(1),e.jsx(i,{variant:"secondary",className:"ml-2 text-xs",children:(b[t]||[]).length})]}),e.jsx("div",{className:"bg-neutral-50 rounded-b-lg p-2 space-y-2 min-h-[200px]",children:(b[t]||[]).map(a=>e.jsxs("div",{className:"bg-white rounded-lg border border-neutral-200 p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-neutral-900",children:["@",a.username||a.sender_id.slice(-8)]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-neutral-100 rounded-full overflow-hidden",children:e.jsx("div",{className:n("h-full rounded-full",w(a.lead_score)),style:{width:`${a.lead_score}%`}})}),e.jsx("span",{className:"text-xs text-neutral-500",children:a.lead_score})]}),e.jsx("div",{className:"flex gap-1 mt-2 flex-wrap",children:(a.tags||[]).slice(0,2).map(s=>e.jsx(i,{variant:"outline",className:"text-xs px-1",children:s},s))})]},a.sender_id))})]},t))})]})}export{Y as default};
