import{r as u,s as e,F as E,U as R}from"./index-Bp_UmaCL.js";import{c as O}from"./caInvoiceService-09kBxQwV.js";import{C as k}from"./chevron-right-Bat6XS3b.js";import{A as F}from"./alert-circle-C1YG_PlL.js";import{I as K}from"./indian-rupee-P_EAgJjo.js";import{aQ as N,aM as z,aL as M,C as p,ad as y,aC as W,ar as I,as as D,au as B,aD as U,av as V}from"./AreaChart-C2i276wS.js";import{W as Y,a as q}from"./wifi-CWiXtYUn.js";import{C as P}from"./clock-BMq5U3Dh.js";const L={pending_review:"#f59e0b",pending_user_confirmation:"#6366f1",approved:"#10b981",rejected:"#ef4444",exported:"#6b7280"},Q={pending_review:"bg-amber-100 text-amber-700",pending_user_confirmation:"bg-indigo-100 text-indigo-700",approved:"bg-emerald-100 text-emerald-700",rejected:"bg-red-100 text-red-700",exported:"bg-neutral-100 text-neutral-600"},J={error:"border-l-red-500 bg-red-50",warning:"border-l-amber-500 bg-amber-50",info:"border-l-blue-500 bg-blue-50"},X={error:"bg-red-500",warning:"bg-amber-500",info:"bg-blue-500"};function h(s){return s>=1e7?`₹${(s/1e7).toFixed(1)}Cr`:s>=1e5?`₹${(s/1e5).toFixed(1)}L`:s>=1e3?`₹${(s/1e3).toFixed(1)}K`:`₹${s.toFixed(0)}`}function H(s){if(!s)return"";try{return new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"short"})}catch{return s}}function Z(s){if(!s)return"Never";const r=Date.now()-new Date(s).getTime(),l=Math.floor(r/6e4);if(l<1)return"Just now";if(l<60)return`${l}m ago`;const a=Math.floor(l/60);return a<24?`${a}h ago`:`${Math.floor(a/24)}d ago`}function ee(s){const r=new Map(s.map(a=>[a.date,a.count])),l=[];for(let a=29;a>=0;a--){const i=new Date;i.setDate(i.getDate()-a);const c=i.toISOString().split("T")[0];l.push({date:c,count:r.get(c)??0,label:i.toLocaleDateString("en-IN",{day:"2-digit",month:"short"})})}return l}function j({icon:s,label:r,value:l,valueStr:a,accent:i,highlight:c}){return e.jsxs("div",{className:`rounded-xl border p-4 bg-white ${c?"ring-2 ring-amber-400":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${i}`,children:e.jsx(s,{className:"h-4 w-4"})}),c&&e.jsx("span",{className:"text-xs font-medium text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full",children:"Needs attention"})]}),e.jsx("div",{className:"text-2xl font-bold text-neutral-900",children:a??l.toLocaleString("en-IN")}),e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:r})]})}function g({children:s}){return e.jsx("h3",{className:"text-sm font-semibold text-neutral-700 mb-3",children:s})}function oe({config:s}){const[r,l]=u.useState(null),[a,i]=u.useState(!0),[c,w]=u.useState(null),b=u.useCallback(async()=>{try{const t=await O.getDashboardOverview();l(t),w(null)}catch(t){w((t==null?void 0:t.message)||"Failed to load overview")}finally{i(!1)}},[]);u.useEffect(()=>{b();const t=setInterval(b,6e4);return()=>clearInterval(t)},[b]);function _(t){window.dispatchEvent(new CustomEvent("dashboard:navigate-tab",{detail:{tabId:t}}))}if(a)return e.jsx("div",{className:"flex items-center justify-center py-24 text-neutral-400 text-sm",children:"Loading overview…"});if(c||!r)return e.jsx("div",{className:"flex items-center justify-center py-24 text-red-500 text-sm",children:c||"No data"});const{kpis:o,status_breakdown:f,invoice_trend:$,gst_summary:d,action_items:S,recent_invoices:T,system_health:n}=r,A=ee($),C=o.total_invoices>0,x=d.total_gst,G=f.reduce((t,m)=>t+m.count,0);return e.jsxs("div",{className:"space-y-6",children:[S.length>0&&e.jsx("div",{className:"space-y-2",children:S.map(t=>e.jsxs("button",{onClick:()=>_(t.tab),className:`w-full flex items-center justify-between px-4 py-3 rounded-xl border-l-4 text-left transition-opacity hover:opacity-80 ${J[t.severity]}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${X[t.severity]}`}),e.jsx("span",{className:"text-sm font-medium text-neutral-800",children:t.label})]}),e.jsx(k,{className:"h-4 w-4 text-neutral-400 shrink-0"})]},t.type))}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(j,{icon:E,label:"Total Invoices",value:o.total_invoices,accent:"bg-blue-100 text-blue-600"}),e.jsx(j,{icon:F,label:"Pending Review",value:o.pending_review,accent:"bg-amber-100 text-amber-600",highlight:o.pending_review>0}),e.jsx(j,{icon:K,label:"Total Invoice Value",value:o.total_amount,valueStr:h(o.total_amount),accent:"bg-emerald-100 text-emerald-600"}),e.jsx(j,{icon:R,label:"Active Clients",value:o.active_clients,accent:"bg-purple-100 text-purple-600"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-xl border bg-white p-5",children:[e.jsx(g,{children:"Invoice Status Breakdown"}),C?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",style:{width:140,height:140},children:[e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(z,{children:[e.jsx(M,{data:f,dataKey:"count",innerRadius:42,outerRadius:62,paddingAngle:2,children:f.map(t=>e.jsx(p,{fill:L[t.status]??"#94a3b8"},t.status))}),e.jsx(y,{formatter:(t,m,v)=>[t,v.payload.label],contentStyle:{fontSize:12}})]})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("span",{className:"text-xl font-bold text-neutral-900",children:G}),e.jsx("span",{className:"text-xs text-neutral-500",children:"total"})]})]}),e.jsx("div",{className:"flex-1 space-y-1.5",children:f.map(t=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full shrink-0",style:{background:L[t.status]??"#94a3b8"}}),e.jsx("span",{className:"text-neutral-600",children:t.label})]}),e.jsx("span",{className:"font-semibold text-neutral-800",children:t.count})]},t.status))})]}):e.jsx("div",{className:"flex items-center justify-center h-36 text-neutral-400 text-sm",children:"No invoices yet"})]}),e.jsxs("div",{className:"rounded-xl border bg-white p-5",children:[e.jsx(g,{children:"Invoices — Last 30 Days"}),C?e.jsx(N,{width:"100%",height:140,children:e.jsxs(W,{data:A,margin:{top:4,right:4,left:-24,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"trendGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#6366f1",stopOpacity:.25}),e.jsx("stop",{offset:"95%",stopColor:"#6366f1",stopOpacity:0})]})}),e.jsx(I,{dataKey:"label",tick:{fontSize:10,fill:"#94a3b8"},interval:6,axisLine:!1,tickLine:!1}),e.jsx(D,{allowDecimals:!1,tick:{fontSize:10,fill:"#94a3b8"},axisLine:!1,tickLine:!1}),e.jsx(y,{contentStyle:{fontSize:12},formatter:t=>[t,"Invoices"],labelFormatter:t=>t}),e.jsx(B,{type:"monotone",dataKey:"count",stroke:"#6366f1",strokeWidth:2,fill:"url(#trendGrad)",dot:!1})]})}):e.jsx("div",{className:"flex items-center justify-center h-36 text-neutral-400 text-sm",children:"No activity yet"})]})]}),e.jsxs("div",{className:"rounded-xl border bg-white p-5",children:[e.jsx(g,{children:"GST Summary"}),x>0?e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex gap-3 flex-wrap",children:[{label:"CGST",value:d.cgst_total,color:"text-blue-600 bg-blue-50"},{label:"SGST",value:d.sgst_total,color:"text-violet-600 bg-violet-50"},{label:"IGST",value:d.igst_total,color:"text-teal-600 bg-teal-50"}].map(({label:t,value:m,color:v})=>e.jsxs("div",{className:`rounded-lg px-4 py-3 ${v} flex-1 min-w-[100px]`,children:[e.jsx("div",{className:"text-xs font-medium opacity-70",children:t}),e.jsx("div",{className:"text-lg font-bold mt-0.5",children:h(m)}),e.jsx("div",{className:"text-xs opacity-60 mt-0.5",children:x>0?`${(m/x*100).toFixed(1)}%`:"—"})]},t))}),e.jsx("div",{className:"flex-1",children:e.jsx(N,{width:"100%",height:70,children:e.jsxs(U,{data:[{name:"CGST",value:d.cgst_total},{name:"SGST",value:d.sgst_total},{name:"IGST",value:d.igst_total}],margin:{top:4,right:4,left:-20,bottom:0},children:[e.jsx(I,{dataKey:"name",tick:{fontSize:11},axisLine:!1,tickLine:!1}),e.jsx(D,{hide:!0}),e.jsx(y,{contentStyle:{fontSize:11},formatter:t=>[h(t),""]}),e.jsxs(V,{dataKey:"value",radius:[4,4,0,0],children:[e.jsx(p,{fill:"#3b82f6"}),e.jsx(p,{fill:"#8b5cf6"}),e.jsx(p,{fill:"#14b8a6"})]})]})})})]}):e.jsx("div",{className:"text-neutral-400 text-sm py-4 text-center",children:"No GST data yet"}),x>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t flex justify-between text-sm",children:[e.jsx("span",{className:"text-neutral-500",children:"Total GST Collected"}),e.jsx("span",{className:"font-bold text-neutral-900",children:h(x)})]})]}),T.length>0&&e.jsxs("div",{className:"rounded-xl border bg-white overflow-hidden",children:[e.jsxs("div",{className:"px-5 pt-5 pb-3 flex items-center justify-between",children:[e.jsx(g,{children:"Recent Invoices"}),e.jsxs("button",{onClick:()=>_("invoices"),className:"text-xs text-indigo-600 hover:underline flex items-center gap-0.5",children:["View all ",e.jsx(k,{className:"h-3 w-3"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-xs text-neutral-500 bg-neutral-50",children:[e.jsx("th",{className:"px-5 py-2 text-left font-medium",children:"Invoice #"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Seller"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-right font-medium",children:"Amount"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Status"})]})}),e.jsx("tbody",{children:T.map(t=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-neutral-50/60 transition-colors",children:[e.jsx("td",{className:"px-5 py-3 font-medium text-neutral-900",children:t.invoice_number||"—"}),e.jsx("td",{className:"px-4 py-3 text-neutral-600 max-w-[140px] truncate",children:t.seller_name||"—"}),e.jsx("td",{className:"px-4 py-3 text-neutral-500",children:H(t.invoice_date)}),e.jsx("td",{className:"px-4 py-3 text-right font-medium text-neutral-900",children:h(t.grand_total)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${Q[t.status]??"bg-neutral-100 text-neutral-600"}`,children:t.status.replace(/_/g," ")})})]},t.id))})]})})]}),e.jsx("div",{className:"rounded-xl border bg-white px-5 py-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-x-6 gap-y-2 text-xs text-neutral-500",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[n.whatsapp_connected?e.jsx(Y,{className:"h-3.5 w-3.5 text-emerald-500"}):e.jsx(q,{className:"h-3.5 w-3.5 text-red-400"}),e.jsxs("span",{children:["WhatsApp"," ",e.jsx("span",{className:n.whatsapp_connected?"text-emerald-600 font-medium":"text-red-500 font-medium",children:n.whatsapp_connected?"connected":"not connected"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(P,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:["Last message: ",e.jsx("span",{className:"text-neutral-700",children:Z(n.last_message_at)})]})]}),n.blocked_phones_count>0&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-400"}),e.jsxs("span",{children:[n.blocked_phones_count," phone",n.blocked_phones_count!==1?"s":""," blocked"]})]}),Object.keys(n.queue_stats).length>0&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-400"}),e.jsxs("span",{children:["Queue:"," ",["pending","processing","failed"].filter(t=>n.queue_stats[t]!==void 0).map(t=>`${n.queue_stats[t]} ${t}`).join(" · ")]})]})]})})]})}export{oe as default};
