import{r as i,y as A,s as e,i as K,j as U,F as V,u as Y,w as Q,q as J}from"./index-Bp_UmaCL.js";import{L as I}from"./loader-2-B7eL5lYw.js";import{C as P,a as G}from"./circle-ChWIwEos.js";import{R as E}from"./refresh-cw-B2lhsbeL.js";import{A as D}from"./alert-circle-C1YG_PlL.js";import{A as L}from"./arrow-left-BmyiyaPF.js";import{A as H}from"./alert-triangle-Dll20bIf.js";import{B as X}from"./book-open-BlF9Aztt.js";import{T as Z}from"./trash-2-DMkfF4m9.js";import{P as ee}from"./plus-CPAcQCsh.js";import{U as se}from"./upload-V_FkRrdv.js";import{S as te}from"./shield-AKBPkDLF.js";import{S as ae}from"./sparkles-yyEVK7tt.js";import{A as ne}from"./arrow-right-DB3G2yu2.js";function re({facebookAppId:g,subscriptionId:m,subdomain:y,onConnected:p,primaryColor:u="#25D366"}){const[x,c]=i.useState("loading"),[S,j]=i.useState(""),[o,N]=i.useState(null),f=i.useRef(!1);i.useEffect(()=>{let b=!1;async function l(){var w;try{const t=await A.getWhatsAppStatus(y);if(!b&&((w=t.data)!=null&&w.connected)){N({phone_number:t.data.phone_number,verified_name:t.data.verified_name||""}),p({phone_number:t.data.phone_number,phone_number_id:"",verified_name:t.data.verified_name||"",waba_id:t.data.waba_id||""}),c("connected");return}}catch{}b||k()}return l(),()=>{b=!0}},[y]);const k=i.useCallback(()=>{if(f.current||window.FB){C();return}window.fbAsyncInit=()=>{C()};const b=document.createElement("script");b.src="https://connect.facebook.net/en_US/sdk.js",b.async=!0,b.defer=!0,b.crossOrigin="anonymous",b.onerror=()=>{c("error"),j("Failed to load Facebook SDK. Please check your internet connection and try again.")},document.body.appendChild(b)},[g]);function C(){window.FB&&(window.FB.init({appId:g,cookie:!0,xfbml:!1,version:"v18.0"}),f.current=!0,c("idle"))}const _=i.useCallback(()=>{if(!window.FB){j("Facebook SDK not loaded. Please refresh and try again."),c("error");return}c("connecting"),j(""),window.FB.login(b=>{var w;const l=(w=b.authResponse)==null?void 0:w.code;if(!l){c("idle");return}c("exchanging"),A.exchangeWhatsAppCode(m,l).then(t=>{const r=t.data;N({phone_number:r.phone_number,verified_name:r.verified_name||""}),p(r),c("connected")}).catch(t=>{j(t.message||"Failed to connect WhatsApp. Please try again."),c("error")})},{config_id:void 0,response_type:"code",override_default_response_type:!0,scope:"whatsapp_business_management,whatsapp_business_messaging,business_management",extras:{feature:"whatsapp_embedded_signup",version:2}})},[m,p]),v=()=>{j(""),f.current?c("idle"):(c("loading"),k())};return x==="loading"?e.jsxs("div",{className:"flex flex-col items-center py-8 gap-3",children:[e.jsx(I,{className:"w-8 h-8 animate-spin text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading WhatsApp connection..."})]}):x==="connected"&&o?e.jsxs("div",{className:"rounded-xl border-2 border-green-200 bg-green-50 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx(P,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"WhatsApp Connected"}),e.jsx("p",{className:"text-sm text-green-700",children:o.phone_number})]})]}),o.verified_name&&e.jsxs("p",{className:"text-sm text-green-600 ml-[52px]",children:["Verified as: ",o.verified_name]}),e.jsxs("button",{onClick:_,className:"mt-4 text-sm text-green-700 hover:text-green-900 underline flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"})," Reconnect with a different account"]})]}):x==="error"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-xl border-2 border-red-200 bg-red-50 p-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(D,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Connection Failed"}),e.jsx("p",{className:"text-sm text-red-600 mt-1",children:S})]})]})}),e.jsxs("button",{onClick:v,className:"w-full py-3 rounded-xl text-white font-medium text-sm flex items-center justify-center gap-2",style:{backgroundColor:u},children:[e.jsx(E,{className:"w-4 h-4"})," Try Again"]})]}):x==="exchanging"?e.jsxs("div",{className:"flex flex-col items-center py-8 gap-3",children:[e.jsx(I,{className:"w-8 h-8 animate-spin",style:{color:u}}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Setting up your WhatsApp Business account..."}),e.jsx("p",{className:"text-xs text-gray-400",children:"This may take a few seconds"})]}):x==="connecting"?e.jsxs("div",{className:"flex flex-col items-center py-8 gap-3",children:[e.jsx(I,{className:"w-8 h-8 animate-spin",style:{color:u}}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Complete the signup in the Meta popup..."}),e.jsx("p",{className:"text-xs text-gray-400",children:"If you don't see a popup, check your browser's popup blocker"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:`${u}20`},children:e.jsx(K,{className:"w-5 h-5",style:{color:u}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Connect your WhatsApp Business"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"A popup will open to connect your Meta Business account. You'll need access to your Facebook account that manages your WhatsApp Business."})]})]})}),e.jsxs("button",{onClick:_,className:"w-full py-3 rounded-xl text-white font-semibold text-sm flex items-center justify-center gap-2 transition-opacity hover:opacity-90",style:{backgroundColor:u},children:[e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"})}),"Connect WhatsApp Business"]})]})}function ie({subdomain:g,onSelected:m,primaryColor:y="#2563eb"}){const[p,u]=i.useState([]),[x,c]=i.useState(!0),[S,j]=i.useState(!1),[o,N]=i.useState(null),[f,k]=i.useState(null),[C,_]=i.useState("");i.useEffect(()=>{v()},[g]);const v=async()=>{try{c(!0),_("");const l=await A.getAvailablePhones(g);u(l.data||[])}catch(l){_(l.message||"Failed to load available numbers")}finally{c(!1)}},b=async()=>{if(o)try{j(!0),_("");const w=(await A.selectPhone(g,o)).data;k(w),m(w)}catch(l){_(l.message||"Failed to assign phone number"),v()}finally{j(!1)}};return x?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(I,{className:"w-6 h-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Loading available numbers..."})]}):f?e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(P,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900",children:"WhatsApp Number Assigned"})]}),e.jsxs("div",{className:"text-sm text-green-800 space-y-1",children:[e.jsx("div",{children:f.display_phone_number}),f.verified_name&&e.jsx("div",{className:"text-green-600",children:f.verified_name})]})]}):p.length===0?e.jsx("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-amber-600"}),e.jsx("span",{className:"text-sm text-amber-800",children:"No phone numbers are currently available. Please contact support."})]})}):e.jsxs("div",{className:"space-y-3",children:[C&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 rounded-lg p-3",children:C}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select a WhatsApp number for your business. This number will receive messages from your clients."}),e.jsx("div",{className:"space-y-2",children:p.map(l=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${o===l.phone_number_id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:[e.jsx("input",{type:"radio",name:"whatsapp_phone",value:l.phone_number_id,checked:o===l.phone_number_id,onChange:()=>N(l.phone_number_id),className:"sr-only"}),e.jsx("div",{className:`w-4 h-4 rounded-full border-2 flex items-center justify-center ${o===l.phone_number_id?"border-blue-500":"border-gray-300"}`,style:o===l.phone_number_id?{borderColor:y}:void 0,children:o===l.phone_number_id&&e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:y}})}),e.jsx(U,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:l.display_phone_number}),l.verified_name&&e.jsx("div",{className:"text-xs text-gray-500",children:l.verified_name})]}),l.quality_rating==="GREEN"&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-green-100 text-green-700 rounded-full",children:"Good"})]},l.phone_number_id))}),e.jsx("button",{onClick:b,disabled:!o||S,className:"w-full py-2.5 rounded-lg text-white font-medium text-sm disabled:opacity-50 flex items-center justify-center gap-2",style:{backgroundColor:y},children:S?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin"})," Assigning..."]}):"Select This Number"})]})}const le=[{code:"91",label:"India (+91)"},{code:"1",label:"US (+1)"},{code:"44",label:"UK (+44)"},{code:"971",label:"UAE (+971)"},{code:"65",label:"Singapore (+65)"},{code:"61",label:"Australia (+61)"},{code:"86",label:"China (+86)"},{code:"81",label:"Japan (+81)"},{code:"49",label:"Germany (+49)"},{code:"33",label:"France (+33)"}];function oe({subdomain:g,onVerified:m,primaryColor:y="#2563eb"}){const[p,u]=i.useState("input"),[x,c]=i.useState("91"),[S,j]=i.useState(""),[o,N]=i.useState(""),[f,k]=i.useState(["","","","","",""]),[C,_]=i.useState(""),[v,b]=i.useState(0),[l,w]=i.useState(null),t=i.useRef([]);i.useEffect(()=>{if(v<=0)return;const s=setInterval(()=>{b(a=>Math.max(0,a-1))},1e3);return()=>clearInterval(s)},[v]);const r=async()=>{var a;const s=S.replace(/\D/g,"");if(!s||s.length<7){_("Please enter a valid phone number");return}if(!o.trim()){_("Please enter your business name");return}_(""),u("sending");try{const d=await A.requestPhoneOTP(g,{phone_number:s,country_code:x,verified_name:o.trim()});if((a=d.data)!=null&&a.already_verified){const F={phone_number_id:d.data.phone_number_id,display_phone_number:d.data.display_phone_number||`+${x} ${s}`,verified_name:d.data.verified_name||o.trim()};w(F),u("verified"),m(F);return}u("otp_sent"),b(60),setTimeout(()=>{var F;return(F=t.current[0])==null?void 0:F.focus()},100)}catch(d){_(d.message||"Failed to send verification code"),u("input")}},h=async()=>{if(!(v>0)){_(""),u("sending"),k(["","","","","",""]);try{const s=S.replace(/\D/g,"");await A.requestPhoneOTP(g,{phone_number:s,country_code:x,verified_name:o.trim()}),u("otp_sent"),b(60),setTimeout(()=>{var a;return(a=t.current[0])==null?void 0:a.focus()},100)}catch(s){_(s.message||"Failed to resend code"),u("otp_sent")}}},n=(s,a)=>{var F;if(a&&!/^\d$/.test(a))return;const d=[...f];d[s]=a,k(d),a&&s<5&&((F=t.current[s+1])==null||F.focus())},$=(s,a)=>{var d;a.key==="Backspace"&&!f[s]&&s>0&&((d=t.current[s-1])==null||d.focus())},R=s=>{var W;s.preventDefault();const a=s.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(a.length===0)return;const d=[...f];for(let B=0;B<a.length&&B<6;B++)d[B]=a[B];k(d);const F=d.findIndex(B=>!B),z=F===-1?5:F;(W=t.current[z])==null||W.focus()},T=async()=>{const s=f.join("");if(s.length!==6){_("Please enter the complete 6-digit code");return}_(""),u("verifying");try{const a=await A.verifyPhoneOTP(g,{code:s});w(a.data),u("verified"),m(a.data)}catch(a){_(a.message||"Verification failed"),u("otp_sent"),k(["","","","","",""]),setTimeout(()=>{var d;return(d=t.current[0])==null?void 0:d.focus()},100)}};return p==="verified"&&l?e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(P,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900",children:"Phone Number Verified"})]}),e.jsxs("div",{className:"text-sm text-green-800 space-y-1",children:[e.jsx("div",{children:l.display_phone_number}),l.verified_name&&e.jsx("div",{className:"text-green-600",children:l.verified_name})]})]}):p==="sending"||p==="verifying"?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 gap-3",children:[e.jsx(I,{className:"w-6 h-6 animate-spin",style:{color:y}}),e.jsx("span",{className:"text-sm text-gray-500",children:p==="sending"?"Sending verification code...":"Verifying..."})]}):p==="otp_sent"?e.jsxs("div",{className:"space-y-4",children:[C&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600 bg-red-50 rounded-lg p-3",children:[e.jsx(D,{className:"w-4 h-4 flex-shrink-0"}),C]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Enter the 6-digit code sent via SMS to"}),e.jsxs("p",{className:"font-medium text-gray-900",children:["+",x," ",S]})]}),e.jsx("div",{className:"flex justify-center gap-2",onPaste:R,children:f.map((s,a)=>e.jsx("input",{ref:d=>{t.current[a]=d},type:"text",inputMode:"numeric",maxLength:1,value:s,onChange:d=>n(a,d.target.value),onKeyDown:d=>$(a,d),className:"w-11 h-12 text-center text-lg font-mono border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":y}},a))}),e.jsx("button",{onClick:T,disabled:f.some(s=>!s),className:"w-full py-2.5 rounded-lg text-white font-medium text-sm disabled:opacity-50",style:{backgroundColor:y},children:"Verify"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("button",{onClick:()=>{u("input"),_(""),k(["","","","","",""])},className:"text-gray-500 hover:text-gray-700 flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"})," Change number"]}),e.jsx("button",{onClick:h,disabled:v>0,className:"disabled:text-gray-400",style:{color:v>0?void 0:y},children:v>0?`Resend in ${v}s`:"Resend code"})]})]}):e.jsxs("div",{className:"space-y-4",children:[C&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600 bg-red-50 rounded-lg p-3",children:[e.jsx(D,{className:"w-4 h-4 flex-shrink-0"}),C]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Enter your phone number to register it for WhatsApp Business messaging. You will receive a verification code via SMS."}),e.jsxs("div",{className:"flex gap-2.5 text-sm bg-amber-50 border border-amber-200 rounded-lg p-3",children:[e.jsx(H,{className:"w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-amber-800",children:[e.jsx("span",{className:"font-medium",children:"Important:"})," If you use personal WhatsApp on this number, it will be disconnected. WhatsApp Business App users are not affected — both can work simultaneously."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("select",{value:x,onChange:s=>c(s.target.value),className:"w-36 px-2 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:le.map(s=>e.jsx("option",{value:s.code,children:s.label},s.code))}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"tel",value:S,onChange:s=>j(s.target.value),placeholder:"8700746556",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Business Display Name"}),e.jsx("input",{type:"text",value:o,onChange:s=>N(s.target.value),placeholder:"e.g. Sharma Tax Consultants",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"This name will appear on your WhatsApp Business profile."})]}),e.jsx("button",{onClick:r,className:"w-full py-2.5 rounded-lg text-white font-medium text-sm flex items-center justify-center gap-2",style:{backgroundColor:y},children:"Send Verification Code"})]})}function q({className:g}){return e.jsx("svg",{className:g,viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"})})}function ce({instagramAppId:g,subscriptionId:m,subdomain:y,onConnected:p,primaryColor:u="#E1306C"}){const[x,c]=i.useState("loading"),[S,j]=i.useState(""),[o,N]=i.useState(null),f=i.useRef(null),k=i.useRef(null);i.useEffect(()=>{let v=!1;async function b(){var l;try{const w=await A.getInstagramStatus(y);if(!v&&((l=w.data)!=null&&l.connected)){const t={instagram_username:w.data.instagram_username||"",instagram_user_id:w.data.instagram_user_id||""};N(t),p(t),c("connected");return}}catch{}v||c("idle")}return b(),()=>{v=!0}},[y]),i.useEffect(()=>{function v(b){var r;if(b.origin!==window.location.origin||((r=b.data)==null?void 0:r.type)!=="instagram_auth")return;const{code:l,error:w}=b.data;if(f.current&&!f.current.closed&&f.current.close(),f.current=null,k.current&&(clearInterval(k.current),k.current=null),w||!l){j(w||"Instagram authorization was cancelled."),c("error");return}c("exchanging");const t=`${window.location.origin}/instagram-callback`;A.connectInstagram(y,l,t).then(h=>{const n=h.data,$={instagram_username:n.instagram_username||"",instagram_user_id:n.instagram_user_id||""};N($),p($),c("connected")}).catch(h=>{j(h.message||"Failed to connect Instagram. Please try again."),c("error")})}return window.addEventListener("message",v),()=>window.removeEventListener("message",v)},[y,p]),i.useEffect(()=>()=>{k.current&&clearInterval(k.current)},[]);const C=i.useCallback(()=>{if(!g){j("Instagram App ID not configured. Please contact support."),c("error");return}c("connecting"),j("");const v=`${window.location.origin}/instagram-callback`,l=`https://www.instagram.com/oauth/authorize?client_id=${encodeURIComponent(g)}&redirect_uri=${encodeURIComponent(v)}&scope=${encodeURIComponent("instagram_business_basic,instagram_business_manage_messages,instagram_business_manage_comments")}&response_type=code&force_reauth=true&enable_fb_login=false&state=${encodeURIComponent(m)}`,w=500,t=700,r=window.screenX+(window.outerWidth-w)/2,h=window.screenY+(window.outerHeight-t)/2;f.current=window.open(l,"instagram_auth",`width=${w},height=${t},left=${r},top=${h},scrollbars=yes,status=yes`),k.current=setInterval(()=>{f.current&&f.current.closed&&(k.current&&(clearInterval(k.current),k.current=null),f.current=null,c(n=>n==="connecting"?"idle":n))},500)},[g,m]),_=()=>{j(""),c("idle")};return x==="loading"?e.jsxs("div",{className:"flex flex-col items-center py-8 gap-3",children:[e.jsx(I,{className:"w-8 h-8 animate-spin text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading Instagram connection..."})]}):x==="connected"&&o?e.jsxs("div",{className:"rounded-xl border-2 border-pink-200 bg-gradient-to-br from-pink-50 to-purple-50 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center",children:e.jsx(P,{className:"w-6 h-6 text-pink-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Instagram Connected"}),o.instagram_username&&e.jsxs("p",{className:"text-sm text-pink-700",children:["@",o.instagram_username]})]})]}),e.jsxs("button",{onClick:C,className:"mt-4 text-sm text-pink-700 hover:text-pink-900 underline flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"})," Reconnect with a different account"]})]}):x==="error"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-xl border-2 border-red-200 bg-red-50 p-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(D,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Connection Failed"}),e.jsx("p",{className:"text-sm text-red-600 mt-1",children:S})]})]})}),e.jsxs("button",{onClick:_,className:"w-full py-3 rounded-xl text-white font-medium text-sm flex items-center justify-center gap-2",style:{background:"linear-gradient(135deg, #E1306C, #833AB4)"},children:[e.jsx(E,{className:"w-4 h-4"})," Try Again"]})]}):x==="exchanging"?e.jsxs("div",{className:"flex flex-col items-center py-8 gap-3",children:[e.jsx(I,{className:"w-8 h-8 animate-spin",style:{color:u}}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Connecting your Instagram account..."}),e.jsx("p",{className:"text-xs text-gray-400",children:"This may take a few seconds"})]}):x==="connecting"?e.jsxs("div",{className:"flex flex-col items-center py-8 gap-3",children:[e.jsx(I,{className:"w-8 h-8 animate-spin",style:{color:u}}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Complete authorization in the Instagram popup..."}),e.jsx("p",{className:"text-xs text-gray-400",children:"If you don't see a popup, check your browser's popup blocker"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{background:"linear-gradient(135deg, #E1306C, #833AB4)"},children:e.jsx(q,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Connect your Instagram Account"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"A popup will open where you can log in with your Instagram username and password. No Facebook Page is required."})]})]})}),e.jsxs("button",{onClick:C,className:"w-full py-3 rounded-xl text-white font-semibold text-sm flex items-center justify-center gap-2 transition-opacity hover:opacity-90",style:{background:"linear-gradient(135deg, #E1306C, #833AB4)"},children:[e.jsx(q,{className:"w-5 h-5"}),"Connect Instagram"]})]})}const M=[{id:"returns",label:"Return Policy",content:`Return Policy

We accept returns within 7 days of delivery. Items must be unused and in original packaging.

To initiate a return:
1. DM us with your order number
2. We'll send you a return shipping label
3. Ship the item back within 3 business days
4. Refund will be processed within 5-7 business days

Exchange is also available for different size or color.

Non-returnable items: Undergarments, customized products, items on final sale.`},{id:"shipping",label:"Shipping Info",content:`Shipping Information

We ship across India via trusted courier partners.

Delivery Timeline:
- Metro cities (Mumbai, Delhi, Bangalore, etc.): 2-4 business days
- Other cities: 4-7 business days
- Remote areas: 7-10 business days

Free shipping on orders above ₹999.
Standard shipping: ₹99

All orders include tracking. You'll receive a tracking link via DM once shipped.

Cash on Delivery (COD) available on orders up to ₹5,000.`},{id:"about",label:"About Us",content:`About Us

We are a modern Indian brand bringing you the latest trends at affordable prices.

Started in 2023, we've served over 10,000+ happy customers across India.

Our Promise:
- Quality products at honest prices
- Easy returns and exchanges
- Fast shipping with tracking
- Dedicated customer support via Instagram DM

We love hearing from our customers! Share your photos with #OurBrand and get featured on our page.`}];function de({subdomain:g,onComplete:m,primaryColor:y}){const[p,u]=i.useState([{question:"",answer:""}]),[x,c]=i.useState(new Set),[S,j]=i.useState(!1),[o,N]=i.useState(!1),[f,k]=i.useState(null),C=()=>{u([...p,{question:"",answer:""}])},_=t=>{p.length!==1&&u(p.filter((r,h)=>h!==t))},v=(t,r,h)=>{const n=[...p];n[t][r]=h,u(n)},b=t=>{const r=new Set(x);r.has(t)?r.delete(t):r.add(t),c(r)},l=async t=>{var h;const r=(h=t.target.files)==null?void 0:h[0];r&&k(r.name)},w=async()=>{j(!0);try{const t=[];for(const r of p)r.question.trim()&&r.answer.trim()&&t.push({title:r.question,content:`Q: ${r.question}
A: ${r.answer}`,category:"faq"});for(const r of x){const h=M.find(n=>n.id===r);h&&t.push({title:h.label,content:h.content,category:r})}for(const r of t)try{await A.runtimeProxy(g,"/api/knowledge-base",{method:"POST",body:JSON.stringify(r)})}catch(h){console.warn("KB article save failed (non-fatal):",h)}N(!0),m(JSON.stringify({articles_count:t.length}))}catch(t){console.error("KB upload failed:",t)}finally{j(!1)}};return o?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(P,{className:"w-12 h-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"font-medium text-gray-900",children:"Knowledge base created!"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Your AI agent can now answer customer questions."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center gap-1",children:[e.jsx(X,{className:"w-4 h-4"})," Add FAQs"]}),e.jsxs("div",{className:"space-y-3",children:[p.map((t,r)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 space-y-2",children:[e.jsx("input",{type:"text",value:t.question,onChange:h=>v(r,"question",h.target.value),placeholder:"Question (e.g. What is your return policy?)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"}),e.jsx("textarea",{value:t.answer,onChange:h=>v(r,"answer",h.target.value),placeholder:"Answer...",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"}),p.length>1&&e.jsxs("button",{onClick:()=>_(r),className:"text-xs text-red-500 hover:text-red-700 flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"})," Remove"]})]},r)),e.jsxs("button",{onClick:C,className:"text-sm font-medium flex items-center gap-1",style:{color:y},children:[e.jsx(ee,{className:"w-4 h-4"})," Add another FAQ"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Quick Templates"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:M.map(t=>e.jsxs("button",{onClick:()=>b(t.id),className:`p-3 rounded-lg border text-sm text-left transition-colors ${x.has(t.id)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(V,{className:"w-4 h-4 mb-1 text-gray-400"}),t.label,x.has(t.id)&&e.jsx(P,{className:"w-4 h-4 text-blue-500 float-right"})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Upload File (Optional)"}),e.jsxs("label",{className:"flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg p-6 cursor-pointer hover:border-gray-400 transition-colors",children:[e.jsx("input",{type:"file",accept:".txt,.pdf",onChange:l,className:"hidden"}),e.jsxs("div",{className:"text-center",children:[e.jsx(se,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:f||"Drop a .txt or .pdf file here"})]})]})]}),e.jsx("button",{onClick:w,disabled:S,className:"w-full py-2.5 rounded-lg text-white font-medium text-sm disabled:opacity-50 flex items-center justify-center gap-2",style:{backgroundColor:y},children:S?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin"})," Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4"})," Save Knowledge Base"]})}),e.jsx("p",{className:"text-center text-xs text-gray-400",children:"You can always add more articles later from the dashboard."})]})}function ue(g){const m=g.replace("#",""),y=parseInt(m.substring(0,2),16),p=parseInt(m.substring(2,4),16),u=parseInt(m.substring(4,6),16);return`${y}, ${p}, ${u}`}function O(g,m){const y=g.replace("#",""),p=Math.min(255,parseInt(y.substring(0,2),16)+Math.round(255*m)),u=Math.min(255,parseInt(y.substring(2,4),16)+Math.round(255*m)),x=Math.min(255,parseInt(y.substring(4,6),16)+Math.round(255*m));return`#${p.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}${x.toString(16).padStart(2,"0")}`}function Se(){const{config:g,subdomain:m}=Y(),{isConfigured:y,subscriptionId:p,refetch:u}=Q(),x=J(),[c,S]=i.useState([]),[j,o]=i.useState({}),[N,f]=i.useState(0),[k,C]=i.useState(!0),[_,v]=i.useState(!1),[b,l]=i.useState("");if(i.useEffect(()=>{y&&x("/dashboard")},[y,x]),i.useEffect(()=>{if(!g||!m)return;const s=g.configuration_schema;if(s!=null&&s.required_fields){S(s.required_fields);const a={};for(const d of s.required_fields)d.default!==void 0&&d.default!==null&&(a[d.key]=String(d.default));Object.keys(a).length>0&&o(d=>({...a,...d}))}else S([{key:"whatsapp_business_name",label:"Business Name",type:"text",placeholder:"e.g. Sharma Tax Consultants",required:!0,description:"Your business name as it appears to clients"},{key:"whatsapp_phone",label:"WhatsApp Business Number",type:"text",placeholder:"+91 9876543210",required:!0,description:"The phone number connected to WhatsApp Business"}]);C(!1)},[g,m]),!g||!m)return null;const w=g.branding||{},t=w.primary_color||"#2563eb",r=ue(t),h=c.length,n=c[N],$=N===h-1,R=async()=>{var s;if(n){if(n.type==="whatsapp_connect"||n.type==="whatsapp_phone_select"||n.type==="whatsapp_verify"||n.type==="instagram_connect"||n.type==="knowledge_base_upload"){if(n.required&&!j[n.key]){l(n.type==="instagram_connect"?"Please connect your Instagram Business account to continue":n.type==="whatsapp_verify"?"Please verify your WhatsApp number to continue":n.type==="whatsapp_phone_select"?"Please select a WhatsApp number to continue":"Please connect your WhatsApp Business account to continue");return}}else{const a=(s=j[n.key])==null?void 0:s.trim();if(n.required&&!a){l(`${n.label} is required`);return}}if(l(""),$){v(!0);try{await A.updateConfig(m,j),await A.completeConfig(m),await u(),x("/dashboard")}catch(a){l(a.message||"Failed to save configuration")}finally{v(!1)}}else f(a=>a+1)}},T=()=>{N>0&&(f(s=>s-1),l(""))};return k?e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(I,{className:"w-8 h-8 animate-spin mx-auto mb-3",style:{color:t}}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading setup..."})]})}):h===0?e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center px-4",children:e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-5",style:{backgroundColor:`rgba(${r}, 0.1)`},children:e.jsx(P,{className:"w-8 h-8",style:{color:t}})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"You're all set!"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Your agent is ready to use. Head to the dashboard to get started."}),e.jsx("button",{onClick:()=>x("/dashboard"),className:"h-11 px-8 rounded-xl text-white font-medium text-sm transition-all hover:brightness-110",style:{background:`linear-gradient(135deg, ${t}, ${O(t,.12)})`,boxShadow:`0 4px 16px rgba(${r}, 0.3)`},children:"Go to Dashboard"})]})}):e.jsxs("div",{className:"min-h-screen bg-slate-50",style:{fontFamily:"'Inter', system-ui, sans-serif"},children:[e.jsx("header",{className:"bg-white border-b border-gray-200/60",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-5 sm:px-8 h-[60px] flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[w.logo_url&&e.jsx("img",{src:w.logo_url,alt:"",className:"h-8 w-auto"}),e.jsx("span",{className:"font-semibold text-[17px] text-gray-900 tracking-[-0.01em]",children:w.brand_name||m})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-400",children:[e.jsx(te,{className:"w-3.5 h-3.5"}),"Secure setup"]})]})}),e.jsxs("div",{className:"max-w-xl mx-auto px-5 sm:px-8 py-10 sm:py-14",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center gap-2 mb-4",children:c.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[a>0&&e.jsx("div",{className:"h-px w-6 sm:w-10 transition-colors duration-300",style:{backgroundColor:a<=N?t:"#e5e7eb"}}),e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold transition-all duration-300 shrink-0",style:a<N?{backgroundColor:t,color:"white"}:a===N?{backgroundColor:`rgba(${r}, 0.1)`,color:t,border:`2px solid ${t}`}:{backgroundColor:"#f3f4f6",color:"#9ca3af"},children:a<N?e.jsx(P,{className:"w-4 h-4"}):a+1})]},a))}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400",children:[e.jsxs("span",{children:["Step ",N+1," of ",h]}),e.jsxs("span",{children:[Math.round((N+1)/h*100),"% complete"]})]}),e.jsx("div",{className:"h-1 bg-gray-200 rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${(N+1)/h*100}%`,backgroundColor:t}})})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-7 sm:p-8",style:{border:"1px solid rgba(0,0,0,0.06)",boxShadow:"0 1px 3px rgba(0,0,0,0.04), 0 4px 16px rgba(0,0,0,0.03)"},children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 rounded-md flex items-center justify-center",style:{backgroundColor:`rgba(${r}, 0.08)`},children:e.jsx(ae,{className:"w-3.5 h-3.5",style:{color:t}})}),e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider",style:{color:t},children:["Step ",N+1]})]}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:n.label}),n.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1.5 leading-relaxed",children:n.description})]}),b&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 rounded-lg p-3 mb-5 border border-red-100",children:b}),e.jsx("div",{className:"mb-6",children:n.type==="knowledge_base_upload"?e.jsx(de,{subdomain:m||"",onComplete:s=>o(a=>({...a,[n.key]:s})),primaryColor:t}):n.type==="instagram_connect"?e.jsx(ce,{instagramAppId:g.facebook_app_id||"",subscriptionId:p||"",subdomain:m||"",onConnected:s=>o(a=>({...a,[n.key]:JSON.stringify(s),instagram_username:s.instagram_username,instagram_user_id:s.instagram_user_id})),primaryColor:t}):n.type==="whatsapp_verify"?e.jsx(oe,{subdomain:m||"",onVerified:s=>o(a=>({...a,[n.key]:s.display_phone_number,whatsapp_phone_number:s.display_phone_number,whatsapp_verified_name:s.verified_name,...s.phone_number_id?{whatsapp_phone_number_id:s.phone_number_id}:{}})),primaryColor:t}):n.type==="whatsapp_phone_select"?e.jsx(ie,{subdomain:m||"",onSelected:s=>o(a=>({...a,[n.key]:s.phone_number_id,whatsapp_phone_number_id:s.phone_number_id,whatsapp_phone_number:s.display_phone_number,whatsapp_verified_name:s.verified_name})),primaryColor:t}):n.type==="whatsapp_connect"?e.jsx(re,{facebookAppId:g.facebook_app_id||"",subscriptionId:p||"",subdomain:m||"",onConnected:s=>o(a=>({...a,[n.key]:JSON.stringify(s)})),primaryColor:t}):n.type==="toggle"?e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer mt-2",children:[e.jsx("input",{type:"checkbox",checked:j[n.key]==="true",onChange:s=>o(a=>({...a,[n.key]:s.target.checked?"true":"false"})),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all",style:j[n.key]==="true"?{backgroundColor:t}:{}}),e.jsx("span",{className:"ms-3 text-sm font-medium text-gray-700",children:j[n.key]==="true"?"Enabled":"Disabled"})]}):n.type==="select"&&n.options?e.jsxs("select",{value:j[n.key]||"",onChange:s=>o(a=>({...a,[n.key]:s.target.value})),className:"w-full px-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:border-transparent bg-white transition-shadow",style:{"--tw-ring-color":`rgba(${r}, 0.4)`},children:[e.jsx("option",{value:"",children:"Select..."}),n.options.map(s=>{const a=typeof s=="string"?s:s.value,d=typeof s=="string"?s.charAt(0).toUpperCase()+s.slice(1):s.label;return e.jsx("option",{value:a,children:d},a)})]}):n.type==="textarea"?e.jsx("textarea",{value:j[n.key]||"",onChange:s=>o(a=>({...a,[n.key]:s.target.value})),placeholder:n.placeholder,rows:4,className:"w-full px-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:border-transparent resize-none transition-shadow",style:{"--tw-ring-color":`rgba(${r}, 0.4)`}}):e.jsx("input",{type:n.type||"text",value:j[n.key]||"",onChange:s=>o(a=>({...a,[n.key]:s.target.value})),placeholder:n.placeholder,className:"w-full px-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:border-transparent transition-shadow",style:{"--tw-ring-color":`rgba(${r}, 0.4)`}})}),e.jsxs("div",{className:"flex gap-3",children:[N>0&&e.jsxs("button",{onClick:T,className:"flex-1 h-11 rounded-xl text-sm font-medium text-gray-700 border border-gray-200 hover:bg-gray-50 flex items-center justify-center gap-2 transition-colors",children:[e.jsx(L,{className:"w-4 h-4"}),"Back"]}),e.jsx("button",{onClick:R,disabled:_,className:"flex-1 h-11 rounded-xl text-white font-medium text-sm disabled:opacity-50 flex items-center justify-center gap-2 transition-all duration-300 hover:brightness-105 hover:shadow-md active:scale-[0.99]",style:{background:`linear-gradient(135deg, ${t}, ${O(t,.12)})`,boxShadow:`0 2px 8px rgba(${r}, 0.25)`},children:_?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin"})," Saving..."]}):$?e.jsxs(e.Fragment,{children:["Complete Setup ",e.jsx(P,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:["Continue ",e.jsx(ne,{className:"w-4 h-4"})]})})]})]}),N<h-1&&e.jsxs("div",{className:"mt-6 space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-400 font-medium uppercase tracking-wider",children:"Coming next"}),c.slice(N+1,N+3).map((s,a)=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-400 bg-white/60 rounded-lg px-4 py-2.5 border border-gray-100",children:[e.jsx(G,{className:"w-3.5 h-3.5 shrink-0"}),e.jsx("span",{children:s.label})]},a))]})]})]})}export{Se as default};
