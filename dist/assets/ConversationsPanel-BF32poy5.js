import{r as o,s as e,R as g,Q as x,z as S,t as V,X as te}from"./index-Bp_UmaCL.js";import{I as ae,B as j}from"./input-GzHbweEW.js";import{B as v}from"./badge-BsIsCzmH.js";import{A as $,b as H,a as Q,T as re}from"./textarea-CYHZra62.js";import{S as K}from"./scroll-area-ftSbuGQS.js";import{I as ne}from"./instagram-DmxKHDe2.js";import{S as le}from"./search-hwF9FksX.js";import{L as X}from"./loader-2-B7eL5lYw.js";import{M as q}from"./message-circle-DHGaqNaA.js";import{C as G}from"./check-DoRmBi-x.js";import{F as ie}from"./flame-D-atu0oC.js";import{a as oe,P as de,M as ce,S as me}from"./smile-D7dLFkCH.js";import{B as ue,U as xe,S as he,C as J}from"./user-CRRRzQSu.js";import{I as pe}from"./image-CYuOe6MX.js";import{C as fe}from"./clock-BMq5U3Dh.js";import"./index-CvZeWDWn.js";const C=g.createContext({open:!1,setOpen:()=>{}});function je({children:d}){const[l,i]=o.useState(!1);return e.jsx(C.Provider,{value:{open:l,setOpen:i},children:e.jsx("div",{className:"relative inline-block",children:d})})}function ge({asChild:d,children:l}){const{setOpen:i,open:t}=g.useContext(C);return d&&g.isValidElement(l)?g.cloneElement(l,{onClick:u=>{var r,p;u.stopPropagation(),i(!t),(p=(r=l.props)==null?void 0:r.onClick)==null||p.call(r,u)}}):e.jsx("button",{type:"button",onClick:()=>i(!t),children:l})}function we({align:d="start",className:l,children:i}){const{open:t,setOpen:u}=g.useContext(C),r=o.useRef(null);return o.useEffect(()=>{if(!t)return;const p=N=>{r.current&&!r.current.contains(N.target)&&u(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[t]),t?e.jsx("div",{ref:r,className:x("absolute z-50 mt-1 min-w-[8rem] overflow-hidden rounded-md border bg-white p-1 shadow-md",d==="end"?"right-0":"left-0",l),children:i}):null}function k({className:d,children:l,onClick:i,...t}){const{setOpen:u}=g.useContext(C);return e.jsx("div",{className:x("relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm hover:bg-gray-100",d),onClick:r=>{i==null||i(r),u(!1)},...t,children:l})}function ze({config:d}){var L,D,F,z,E;const[l,i]=o.useState([]),[t,u]=o.useState(null),[r,p]=o.useState(""),[N,M]=o.useState(!1),[y,W]=o.useState(""),[b,Y]=o.useState("all"),[Z,_]=o.useState(!0),U=(d==null?void 0:d.endpoint)||"/api/conversations";o.useEffect(()=>{_(!0),S.get(U).then(s=>{var c;const h=(((c=s.data)==null?void 0:c.data)||s.data||[]).map(a=>{var m,w,P,R,B,O;return{...a,id:a.id||a.sender_id||"",sender_id:a.sender_id||a.id||"",user:a.user&&a.user.username?a.user:{id:((m=a.user)==null?void 0:m.id)||a.sender_id||a.id||"",username:((w=a.user)==null?void 0:w.username)||a.username||a.sender_id||"unknown",fullName:((P=a.user)==null?void 0:P.fullName)||a.full_name||"",avatarUrl:((R=a.user)==null?void 0:R.avatarUrl)||a.avatar_url||"",isVerified:((B=a.user)==null?void 0:B.isVerified)||!1,followersCount:((O=a.user)==null?void 0:O.followersCount)||0},lastMessage:a.lastMessage||"",lastMessageTime:a.lastMessageTime||a.updated_at||"",unreadCount:a.unreadCount||0,status:a.status||"active",messages:(a.messages||[]).map(f=>({id:f.id||"",sender:f.role==="assistant"?"agent":"user",text:f.text||"",timestamp:f.timestamp||"",status:f.role==="assistant"?"sent":void 0,mediaUrl:f.mediaUrl||void 0}))}});i(h)}).catch(s=>console.error("Failed to load conversations:",s)).finally(()=>_(!1))},[U]);const I=l.filter(s=>{var m;const n=((m=s.user)==null?void 0:m.username)||"",h=s.lastMessage||"",c=n.toLowerCase().includes(y.toLowerCase())||h.toLowerCase().includes(y.toLowerCase()),a=b==="all"||b==="unread"&&s.unreadCount>0||b==="pending"&&s.status==="pending";return c&&a}),T=o.useCallback(async()=>{if(!(!t||!r.trim())){M(!0);try{await S.post(`/api/conversations/${t.id}/reply`,{message:r}),p("")}catch(s){console.error("Failed to send reply:",s)}finally{M(!1)}}},[t,r]),A=s=>{const n=new Date(s),c=new Date().getTime()-n.getTime(),a=Math.floor(c/6e4),m=Math.floor(c/36e5),w=Math.floor(c/864e5);return a<1?"now":a<60?`${a}m`:m<24?`${m}h`:w<7?`${w}d`:n.toLocaleDateString("en-US",{month:"short",day:"numeric"})},ee=s=>{switch(s){case"positive":return"bg-emerald-100 text-emerald-700";case"negative":return"bg-red-100 text-red-700";default:return"bg-neutral-100 text-neutral-700"}},se=s=>{switch(s){case"read":return e.jsx(J,{className:"w-3 h-3 text-blue-500"});case"delivered":return e.jsx(J,{className:"w-3 h-3 text-neutral-400"});case"sent":return e.jsx(G,{className:"w-3 h-3 text-neutral-400"});case"sending":return e.jsx(fe,{className:"w-3 h-3 text-neutral-400"});default:return null}};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-0 h-[calc(100vh-12rem)] min-h-[500px] max-h-[900px] bg-white rounded-xl border border-neutral-200 overflow-hidden",children:[e.jsxs("div",{className:"lg:col-span-1 border-r border-neutral-200 flex flex-col overflow-hidden min-h-0",children:[e.jsxs("div",{className:"p-4 border-b border-neutral-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-pink-500"}),"Conversations"]}),e.jsx(v,{variant:"secondary",children:l.length})]}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-neutral-400"}),e.jsx(ae,{placeholder:"Search conversations...",value:y,onChange:s=>W(s.target.value),className:"pl-9 h-9"})]}),e.jsx("div",{className:"flex gap-2 mt-3",children:["all","unread","pending"].map(s=>e.jsx("button",{onClick:()=>Y(s),className:x("px-3 py-1 rounded-full text-xs font-medium transition-colors",b===s?"bg-neutral-900 text-white":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"),children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsx(K,{className:"flex-1",children:Z?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(X,{className:"w-6 h-6 animate-spin text-neutral-400"})}):I.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-neutral-500",children:[e.jsx(q,{className:"w-8 h-8 mb-2"}),e.jsx("p",{className:"text-sm",children:"No conversations found"})]}):e.jsx("div",{className:"divide-y divide-neutral-100",children:I.map(s=>{var n,h,c,a;return e.jsxs(V.button,{onClick:()=>u(s),whileHover:{backgroundColor:"rgba(0,0,0,0.02)"},className:x("w-full p-4 flex items-start gap-3 text-left transition-colors",(t==null?void 0:t.id)===s.id&&"bg-neutral-50"),children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsxs($,{className:"w-12 h-12",children:[((n=s.user)==null?void 0:n.avatarUrl)&&e.jsx(H,{src:s.user.avatarUrl}),e.jsx(Q,{className:"bg-gradient-to-br from-pink-500 to-purple-600 text-white",children:(((h=s.user)==null?void 0:h.username)||"??").slice(0,2).toUpperCase()})]}),s.unreadCount>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center",children:s.unreadCount})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:x("font-medium truncate",s.unreadCount>0&&"font-semibold"),children:["@",((c=s.user)==null?void 0:c.username)||"unknown",((a=s.user)==null?void 0:a.isVerified)&&e.jsx(G,{className:"inline w-3 h-3 ml-1 text-blue-500"})]}),e.jsx("span",{className:"text-xs text-neutral-500",children:A(s.lastMessageTime)})]}),e.jsx("p",{className:x("text-sm truncate",s.unreadCount>0?"text-neutral-900":"text-neutral-500"),children:s.lastMessage}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex gap-1 mt-1.5",children:s.tags.slice(0,2).map(m=>e.jsx(v,{variant:"outline",className:"text-xs px-1.5 py-0",children:m},m))})]})]},s.id)})})})]}),e.jsx("div",{className:"lg:col-span-2 flex flex-col overflow-hidden min-h-0",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-neutral-100 flex items-center justify-between bg-neutral-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs($,{className:"w-10 h-10",children:[((L=t.user)==null?void 0:L.avatarUrl)&&e.jsx(H,{src:t.user.avatarUrl}),e.jsx(Q,{className:"bg-gradient-to-br from-pink-500 to-purple-600 text-white",children:(((D=t.user)==null?void 0:D.username)||"??").slice(0,2).toUpperCase()})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["@",((F=t.user)==null?void 0:F.username)||"unknown"]}),e.jsxs("p",{className:"text-xs text-neutral-500",children:[((E=(z=t.user)==null?void 0:z.followersCount)==null?void 0:E.toLocaleString())||0," followers"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.lead_score!=null&&e.jsxs(v,{className:t.lead_score>=70?"bg-emerald-100 text-emerald-700":t.lead_score>=30?"bg-amber-100 text-amber-700":"bg-neutral-100 text-neutral-600",children:[e.jsx(ie,{className:"w-3 h-3 mr-1"}),t.lead_score]}),e.jsx(v,{className:ee(t.sentiment),children:t.sentiment||"neutral"}),e.jsx(j,{variant:t.ai_paused?"default":"outline",size:"sm",className:t.ai_paused?"bg-orange-500 hover:bg-orange-600 text-white":"",onClick:async()=>{const s=t.sender_id||t.id,n=!t.ai_paused;try{await S.put(`/api/conversations/${s}/handoff`,{ai_paused:n}),u({...t,ai_paused:n})}catch(h){console.error("Handoff toggle failed:",h)}},children:t.ai_paused?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-3 h-3 mr-1"})," Resume AI"]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-3 h-3 mr-1"})," Pause AI"]})}),e.jsxs(je,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",children:e.jsx(ce,{className:"w-4 h-4"})})}),e.jsxs(we,{align:"end",children:[e.jsx(k,{children:"Mark as resolved"}),e.jsx(k,{children:"Add tag"}),e.jsx(k,{children:"View profile"})]})]}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>u(null),className:"lg:hidden",children:e.jsx(te,{className:"w-4 h-4"})})]})]}),e.jsx(K,{className:"flex-1 p-4",children:e.jsx("div",{className:"space-y-4",children:t.messages.map(s=>{var n;return e.jsx(V.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:x("flex",s.sender==="agent"?"justify-end":"justify-start"),children:e.jsxs("div",{className:x("max-w-[70%] rounded-2xl px-4 py-2",s.sender==="agent"?"bg-gradient-to-r from-pink-500 to-purple-600 text-white":"bg-neutral-100 text-neutral-900"),children:[e.jsxs("div",{className:x("flex items-center gap-1 text-xs mb-1",s.sender==="agent"?"text-white/70":"text-neutral-500"),children:[s.sender==="agent"?e.jsx(ue,{className:"w-3 h-3"}):e.jsx(xe,{className:"w-3 h-3"}),s.sender==="agent"?"AI Agent":((n=t.user)==null?void 0:n.username)||"User"]}),s.mediaUrl&&e.jsx("img",{src:s.mediaUrl,alt:"Media",className:"rounded-lg mb-2 max-w-full"}),e.jsx("p",{className:"text-sm",children:s.text}),e.jsxs("div",{className:x("flex items-center justify-end gap-1 mt-1 text-xs",s.sender==="agent"?"text-white/70":"text-neutral-500"),children:[A(s.timestamp),s.sender==="agent"&&se(s.status)]})]})},s.id)})})}),e.jsx("div",{className:"p-4 border-t border-neutral-100 bg-white",children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(re,{placeholder:"Type a message...",value:r,onChange:s=>p(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),T())},className:"min-h-[44px] max-h-[120px] resize-none pr-20",rows:1}),e.jsxs("div",{className:"absolute right-2 bottom-2 flex items-center gap-1",children:[e.jsx(j,{variant:"ghost",size:"icon",className:"w-8 h-8",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(j,{variant:"ghost",size:"icon",className:"w-8 h-8",children:e.jsx(me,{className:"w-4 h-4"})})]})]}),e.jsx(j,{onClick:T,disabled:!r.trim()||N,className:"h-11 px-4 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700",children:N?e.jsx(X,{className:"w-4 h-4 animate-spin"}):e.jsx(he,{className:"w-4 h-4"})})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-neutral-500",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-neutral-100 flex items-center justify-center mb-4",children:e.jsx(q,{className:"w-8 h-8"})}),e.jsx("p",{className:"font-medium mb-1",children:"Select a conversation"}),e.jsx("p",{className:"text-sm",children:"Choose a conversation from the list to view messages"})]})})]})}export{ze as default};
